*****************
PROCEDURE INDICES
*****************
DEFI WIND WININD FROM 05,50 TO 07,72 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WININD
   RETURN
endif
***
CLOSE DATA
CLOSE INDEX
***
USE CONCTAS
IF FILLOC()
   INDEX ON CODCTA            TO CONCTAS1
   INDEX ON DESCTA1+DESCTA2   TO CONCTAS2
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
***
USE CONADG
IF FILLOC()
   INDEX ON CODCOMG           TO CONADG1
   INDEX ON DTOS(FECCOMG)     TO CONADG2
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
***
USE CONADD
IF FILLOC()
   INDEX ON CODCOMD              TO CONADD1
   INDEX ON DTOS(FECCOMD)+CODCTA TO CONADD2
   INDEX ON CODCTA+DTOS(FECCOMD) TO CONADD3
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
***
USE CONAAG
IF FILLOC()
   INDEX ON CODCOMG           TO CONAAG1
   INDEX ON DTOS(FECCOMG)     TO CONAAG2
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
***
USE CONAAD
IF FILLOC()
   INDEX ON CODCOMD              TO CONAAD1
   INDEX ON DTOS(FECCOMD)+CODCTA TO CONAAD2
   INDEX ON CODCTA+DTOS(FECCOMD) TO CONAAD3
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
***
***
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO WITH WTEXT
RELE WIND WININD
CLOSE DATA
CLOSE INDEX
SET PROC TO SYSPROC
RETURN TO MASTER

******************
PROCEDURE COMPACTA
******************
DEFI WIND WINCOM FROM 05,50 TO 07,72 ;
                 TITLE " COMPACTAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCOM
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WINCOM
   RETURN
endif
***
***
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO WITH WTEXT
RELE WIND WINCOM
CLOSE DATA
CLOSE INDEX
SET PROCEDURE TO SYSPROC
RETURN TO MASTER

****************
PROCEDURE RECLOC
****************
DEFI WIND WINRLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGRL
STORE .F. TO WRECMES
STORE .T. TO WRECLOC
DO WHILE WRECLOC
   IF RLOCK()
      STORE .T. TO WFLAGRL
      EXIT
   ELSE
      IF .NOT. WRECMES
         ACTI WIND WINRLOCK
         @ 02,15 SAY "REGISTRO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 03,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WRECMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINRLOCK
RETURN WFLAGRL

****************
PROCEDURE FILLOC
****************
DEFI WIND WINFLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGFL
STORE .F. TO WFILMES
STORE .T. TO WFILLOC
DO WHILE WFILLOC
   IF FLOCK()
      STORE .T. TO WFLAGFL
      EXIT
   ELSE
      IF .NOT. WFILMES
         ACTI WIND WINFLOCK
         @ 02,15 SAY "ARCHIVO  OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 03,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WFILMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINFLOCK
RETURN WFLAGFL

******************
PROCEDURE PREGUNTA
******************
DEFI WIND WINPRE FROM 22,0 TO 24,79;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINPRE
STORE .T. TO WPREG
DO WHILE WPREG
   @ 0,0
   STORE SUBSTR(WCH,1,1) TO WCHOICE
   @ 0,40- (LEN(WTEXT)/2) SAY WTEXT GET WCHOICE
   READ
   STORE UPPER(WCHOICE) TO WCHOICE
   IF AT(WCHOICE,WCH) > 0
      STORE .F. TO WPREG
      EXIT
   ENDIF
ENDDO
@ 0,0
STORE WCHOICE TO WCH
RELE WIND WINPRE
RETURN
***************
PROCEDURE AVISO
***************
PARAMETERS WTEXT
DEFI WIND WINAVI FROM 22,0 TO 24,79;
     DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINAVI
?? CHR(7)
?? CHR(7)
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
READ
RELE WIND WINAVI
RETURN

*****************
PROCEDURE MENSAJE
*****************
PARAMETERS WTEXT
DEFI WIND WINMES FROM 22,0 TO 24,79 DOUBLE  NOFLOAT;
                 NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINMES
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
RELE WIND WINMES
RETURN

****************
PROCEDURE CHKACC
****************
PARAMETERS WUSERCODE,WPROGRAMA,WACCESO,WFILTRO
SELECT SYSUSERD
STORE WUSERCODE+WPROGRAMA TO WCLAVEACC
SEEK WCLAVEACC
IF FOUND()
   STORE ACCESO TO WACCESO
   STORE FILTRO TO WFILTRO
ENDIF
RETURN

*************
PROC ACEPCANC
*************
PARA WTITLE
DEFI WIND WINDAC FROM 12,20 TO 14,60;
          TITLE WTITLE;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINDAC
DO WHILE .T.
   @ 00,03 SAY "OPCIONES: ";
   GET WOP PICT "@*H ACEPTAR  ;CANCELAR " DEFA WOP
   READ
   IF LASTKEY()=13
      EXIT
   ENDIF
ENDDO
RELE WIND WINDAC
RETURN

************
PROC PROCNUL
************
STORE "OPERACION RECHAZADA, FAVOR REINTENTAR." TO WTEXT
DO AVISO WITH WTEXT
RETURN

***********
PROC VALCTA
***********
*** Elimina espacios y puntos innecesarios
***
store m.codcta      to wcodcta
store len(m.codcta) to wlencta
store len(m.codcta) to wconcar
do while wconcar>0
   store substr(wcodcta,wconcar,1) to wcar
   if wcar=" ".or.wcar="."
      *** ok
   else
      exit
   endif
   store wconcar-1 to wconcar
enddo
store substr(wcodcta,1,(wconcar))+space(wlencta-wconcar) to m.codcta
if at(" ",rtrim(m.codcta))>0
   return .f.
else
   return .t.
endif
RETURN

***********
PROC CONNUM
***********
PARAMETERS WNUMERO
STORE LTRIM(STR(WNUMERO,7))                   TO WNUMERO
STORE REPLICATE("0",7-LEN(WNUMERO))+WNUMERO   TO WNUMERO
RETURN

